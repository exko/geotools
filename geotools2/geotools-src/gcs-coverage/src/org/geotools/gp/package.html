<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>
  <HEAD>
    <TITLE>package org.geotools.gp</TITLE>
  </HEAD>
  <BODY>
    <P ALIGN="justify">Grid coverage processing implementation. The following is
    adapted from <A HREF="http://www.opengis.org/techno/specs/">OpenGIS® Grid
    Coverages Implementation Specification</A>:</P>

    <BLOCKQUOTE><FONT COLOR="#008060">
    <P ALIGN="justify">This optional interface provides operations for different
    ways of accessing the grid coverage values as well as image processing
    functionality. The list of available processing operations is implementation
    dependent. The interface has a discovery mechanism to determine the available
    processing operations. These processing operations will transform values
    within a single sample dimension, and leave the values in other sample
    dimensions unaffected. The modified sample dimension may also change its
    type (e.g. from <CODE>4BIT</CODE> to <CODE>1BIT</CODE>). The actual
    underlying grid data remains unchanged. The interface has been designed to
    allow the adaptations to be done in a "pipe-lined" manner. The interface
    operates on {@link org.geotools.gc.GridCoverage} to create a new 
    {@link org.geotools.gc.GridCoverage}. The interface does not need to
    make a copy of the source grid data. Instead, it can return a grid coverage
    object which applies the adaptations on the original grid coverage whenever
    a block of data is requested. In this way, a pipeline of several grid
    coverages can be constructed cheaply.</P>

    <P ALIGN="justify">This interface can perform any of the following:</P>

    <OL>
      <LI>Change the number of bands being accessed.</LI>
      <LI>Change the value sequencing in which the grid values are retrieved.</LI>
      <LI>Allow re-sampling of the grid coverage for a different geometry.
          Creating a new {@link org.geotools.gc.GridCoverage} with different
          grid geometry allows for reprojecting the grid coverage to another
          projection and another georeferencing type, resampling to another cell
          resolution and subsetting the grid coverage.</LI>
      <LI>Modify the way the grid values are accessed (filtered, classified...).</LI>
      <LI>Change the interpolation method used when evaluating points which fall
          between grid cells.</LI>
      <LI>Filtering</LI>
      <LI>Image enhancements.</LI>
      <LI>etc.</LI>
    </OL>
    </FONT></BLOCKQUOTE>

    <P>&nbsp;</P>
    <P>&nbsp;</P>
    <H1><U>Supported operations</U></H1>
    <P ALIGN="justify">The default {@link org.geotools.gp.GridCoverageProcessor}
    supports the following operations:</P>

    <UL>
      <LI><A HREF="#BandSelect">BandSelect</A></LI>
      <LI><A HREF="#Interpolate">Interpolate</A></LI>
      <LI><A HREF="#Resample">Resample</A></LI>
      <LI><A HREF="#Rescale">Rescale</A></LI>
      <LI><A HREF="#GradientMagnitude">GradientMagnitude</A></LI>
    </UL>

    <P>&nbsp;</P>
    <HR>
    <P>&nbsp;</P>
    <H2><A NAME="BandSelect">BandSelect</A></H2>
    <P ALIGN="justify">Chooses <var>N</var> bands from a grid coverage and
    copies the sample data of these bands to the destination coverage in the
    order specified. The <code>bandIndices</code> parameter specifies the
    source band (or <code>SampleDimension</code>) indices, and its size
    (<code>bandIndices.length</code>) determines the number of bands of the
    destination coverage. The destination coverage may have any number of bands,
    and a particular band of the source coverage may be repeated in the
    destination coverage by specifying it multiple times in the
    <code>bandIndices</code> parameter.</P>

    <P ALIGN="justify">This operation can also be used for selecting a different
    "visible band". Some images may contain useful data in more than 1 band, but
    show the content of only 1 band at rendering time. The <code>visibleBand</code>
    parameter can be used for selecting this band. If ommited, then the new grid
    coverage will inherit its source's visible band.</P>

    <P><STRONG>Name:</STRONG>&nbsp;<CODE>"BandSelect"</CODE><BR>
       <STRONG>Parameters:</STRONG></P>
    <table border='3' cellpadding='6' bgcolor='F4F8FF'>
      <tr bgcolor='#B9DCFF'>
        <th>Name</th>
        <th>Class</th>
        <th>Default value</th>
        <th>Minimum value</th>
        <th>Maximum value</th>
      </tr>
      <tr>
        <td>"Source"</td>
        <td>{@link org.geotools.gc.GridCoverage}</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"bandIndices"</td>
        <td><code>int[]</code></td>
        <td align="center">Same as source</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"visibleBand"</td>
        <td><code>Integer</code></td>
        <td align="center">Same as source</td>
        <td align="center">0</td>
        <td align="center">N/A</td>
      </tr>
    </table>

    <P>&nbsp;</P>
    <HR>
    <P>&nbsp;</P>
    <H2><A NAME="Interpolate">Interpolate</A></H2>
    <P ALIGN="justify">This operation specifies the interpolation type to be
    used to interpolate values for points which fall between grid cells. The
    default value is nearest neighbor. The new interpolation type operates
    on all sample dimensions.</P>

    <P><STRONG>Name:</STRONG>&nbsp;<CODE>"Interpolate"</CODE><BR>
       <STRONG>Parameters:</STRONG></P>
    <table border='3' cellpadding='6' bgcolor='F4F8FF'>
      <tr bgcolor='#B9DCFF'>
        <th>Name</th>
        <th>Class</th>
        <th>Default value</th>
        <th>Minimum value</th>
        <th>Maximum value</th>
      </tr>
      <tr>
        <td>"Source"</td>
        <td>{@link org.geotools.gc.GridCoverage}</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"Type"</td>
        <td>{@link java.lang.CharSequence}</td>
        <td>"NearestNieghbor"</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
    </table>
    <P ALIGN="justify">Possible values for type are: "NearestNeighbor", "Bilinear" and
    "Bicubic" (the "Optimal" interpolation type is currently not supported). The Geotools
    implementation provides two extensions to OpenGIS specification: First, it accepts
    also an {@link javax.media.jai.Interpolation} argument type, for interoperability
    with <A HREF="http://java.sun.com/products/java-media/jai/">Java Advanced Imaging</A>.
    Second, it accepts also an array of {@link java.lang.String} or {@link javax.media.jai.Interpolation}
    objects. When an array is specified, the first interpolation in the array is applied.
    If this interpolation returns a <code>NaN</code> value, then the second interpolation
    is tried as a fallback. If the second interpolation returns also a <code>NaN</code>
    value, then the third one is tried and so on until an interpolation returns a real
    number or until we reach the end of interpolation list. This behavior is convenient
    when processing remote sensing images of geophysics data, for example <I>Sea Surface
    Temperature</I> (SST), in which clouds may mask many pixels (i.e. set them to some
    <code>NaN</code> values). Because "Bicubic" interpolation needs 4&times;4 pixels while
    "Bilinear" interpolation needs only 2x2 pixels, the "Bilinear" interpolation is
    less likely to fails because of clouds (<code>NaN</code> values) than "Bicubic"
    (only one <code>NaN</code> value is enough to make an interpolation fails). One
    cans workaround the problem by trying a bicubic interpolation first, then a linear
    interpolation if "Bicubic" failed at a particular location, etc. This behavior
    can be provided with the following "Type" argument:
    <code>new String[]{"Bicubic", "Bilinear", "NearestNeighbor"}</code>.</P>

    <P>&nbsp;</P>
    <HR>
    <P>&nbsp;</P>
    <H2><A NAME="Resample">Resample</A></H2>
    <P ALIGN="justify">Resample a grid coverage using a different grid geometry.
    This operation provides the following functionality:</P>
    <UL>
      <LI><strong>Resampling</strong><br>
          The grid coverage can be resampled at a different cell resolution.
          Some implementations may be able to do resampling efficiently at any
          resolution. Also a non-rectilinear grid coverage can be accessed as
          rectilinear grid coverage with this operation.</LI>
      <LI><strong>Reprojecting</strong><br>
          The new grid geometry can have a different coordinate system than the
          underlying grid geometry. For example, a grid coverage can be
          reprojected from a geodetic coordinate system to Universal Transverse
          Mercator coordinate system.</LI>
      <LI><strong>Subsetting</strong><br>
          A subset of a grid can be viewed as a separate coverage by using this
          operation with a grid geometry which as the same geoferencing and a
          region. Grid range in the grid geometry defines the region to subset
          in the grid coverage.</LI>
    </UL>

    <P><STRONG>Name:</STRONG>&nbsp;<CODE>"Resample"</CODE><BR>
       <STRONG>Parameters:</STRONG></P>
    <table border='3' cellpadding='6' bgcolor='F4F8FF'>
      <tr bgcolor='#B9DCFF'>
        <th>Name</th>
        <th>Class</th>
        <th>Default value</th>
        <th>Minimum value</th>
        <th>Maximum value</th>
      </tr>
      <tr>
        <td>"Source"</td>
        <td>{@link org.geotools.gc.GridCoverage}</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"InterpolationType"</td>
        <td>{@link java.lang.CharSequence}</td>
        <td>"NearestNieghbor"</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"CoordinateSystem"</td>
        <td>{@link org.geotools.cs.CoordinateSystem}</td>
        <td>Same as source grid coverage</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"GridGeometry"</td>
        <td>{@link org.geotools.gc.GridGeometry}</td>
        <td>(automatic)</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
    </table>
    <P ALIGN="justify">The "Resample" operation use the default
    {@link org.geotools.ct.CoordinateTransformationFactory} for creating a
    transformation from the source to the destination coordinate systems. If
    a custom factory is desired, it may be supplied as a rendering hint with
    the {@link org.geotools.gp.Hints#COORDINATE_TRANSFORMATION_FACTORY}
    key. Rendering hints can be supplied to {@link org.geotools.gp.GridCoverageProcessor}
    at construction time.</P>

    <P>&nbsp;</P>
    <HR>
    <P>&nbsp;</P>
    <H2><A NAME="Rescale">Rescale</A></H2>
    <P ALIGN="justify">Maps the pixel values of an image from one range to
    another range by multiplying each pixel value by one of a set of constants
    and then adding another constant to the result of the multiplication.
    The destination pixel values are defined by the pseudocode:</P>

    <BLOCKQUOTE><CODE>
    dst[<var>x</var>][<var>y</var>][<var>b</var>] =
    src[<var>x</var>][<var>y</var>][<var>b</var>]*<strong>constant</strong> + <strong>offset</strong>;
    </CODE></BLOCKQUOTE>

    <P><STRONG>Name:</STRONG>&nbsp;<CODE>"Rescale"</CODE><BR>
       <STRONG>Parameters:</STRONG></P>
    <table border='3' cellpadding='6' bgcolor='F4F8FF'>
      <tr bgcolor='#B9DCFF'>
        <th>Name</th>
        <th>Class</th>
        <th>Default value</th>
        <th>Minimum value</th>
        <th>Maximum value</th>
      </tr>
      <tr>
        <td>"Source"</td>
        <td>{@link org.geotools.gc.GridCoverage}</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"constants"</td>
        <td><code>double[]</code></td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"offsets"</td>
        <td><code>double[]</code></td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
    </table>

    <P>&nbsp;</P>
    <HR>
    <P>&nbsp;</P>
    <H2><A NAME="GradientMagnitude">GradientMagnitude</A></H2>
    <P ALIGN="justify">Edge detector which computes the magnitude of the
    image gradient vector in two orthogonal directions. The result of the
    "GradientMagnitude" operation may be defined as:</P>

    <BLOCKQUOTE><CODE>
    dst[<var>x</var>][<var>y</var>][<var>b</var>] = {@linkplain java.lang.Math#sqrt sqrt}(
    <strong>SH</strong>(<var>x</var>,<var>y</var>,<var>b</var>)<sup>2</sup> +
    <strong>SV</strong>(<var>x</var>,<var>y</var>,<var>b</var>)<sup>2</sup> )
    </CODE></BLOCKQUOTE>
 
    <P ALIGN="justify">where <CODE>SH(x,y,b)</CODE> and <CODE>SV(x,y,b)</CODE>
    are the horizontal and vertical gradient images generated from band <VAR>b</VAR>
    of the source image by correlating it with the supplied orthogonal (horizontal
    and vertical) gradient masks.</P>

    <P><STRONG>Name:</STRONG>&nbsp;<CODE>"GradientMagnitude"</CODE><BR>
       <STRONG>Parameters:</STRONG></P>
    <table border='3' cellpadding='6' bgcolor='F4F8FF'>
      <tr bgcolor='#B9DCFF'>
        <th>Name</th>
        <th>Class</th>
        <th>Default value</th>
        <th>Minimum value</th>
        <th>Maximum value</th>
      </tr>
      <tr>
        <td>"Source"</td>
        <td>{@link org.geotools.gc.GridCoverage}</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"mask1"</td>
        <td>{@link javax.media.jai.KernelJAI}</td>
        <td>{@link javax.media.jai.KernelJAI#GRADIENT_MASK_SOBEL_HORIZONTAL}</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
      <tr>
        <td>"mask2"</td>
        <td>{@link javax.media.jai.KernelJAI}</td>
        <td>{@link javax.media.jai.KernelJAI#GRADIENT_MASK_SOBEL_VERTICAL}</td>
        <td align="center">N/A</td>
        <td align="center">N/A</td>
      </tr>
    </table>
    <P ALIGN="justify">Before to compute the gradients, the kernels are tested
    against artificials horizontal and vertical gradients of one <cite>unit of
    sample / unit of localization</cite>. For example:</P>
    <UL>
      <LI>For an image of elevation (meters) using a geographic coordinate system (degrees
          of latitude and longitude), the units are <strong>m/degree</strong>.</LI>
      <LI>For an image of temperature (°C) using a projected coordinate system (kilometers),
          the units are <strong>°C/km</strong>.</LI>
    </UL>
    <P ALIGN="justify">Kernels are normalized by dividing all their coefficients
    by the result of this test. In other words, kernels are normalized in such a
    way that applying the "GradientMagnitude" operation on a horizontal or
    vertical gradient of 1 such "geophysical" units will give a result of 1.
    This is an attempt to give geophysical meaning to the numbers produced by the
    "GradientMagnitude" operation. This normalization depends of the coverage's
    {@linkplain org.geotools.gc.GridCoverage#getGridGeometry grid geometry}.</P>
  </BODY>
</HTML>
