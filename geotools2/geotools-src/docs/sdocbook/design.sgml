<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD Simplified DocBook XML V4.1.2.5//EN"
"http://www.oasis-open.org/docbook/xml/simple/4.1.2.5/sdocbook.dtd">
<!-- Use the following if you want to use ant to style this file when offline
"file:../../extbin/gtbuild/xxe/dtd/sdocbook/sdocbook.dtd"-->

<article id="index">
  <articleinfo>
    <title>Geotools2 Software Design Description</title>

    <author>
      <firstname>Cameron</firstname>

      <surname>Shorter</surname>
    </author>

    <date>$Id: design.sgml,v 1.8 2002/11/21 10:38:57 camerons Exp $</date>
  </articleinfo>

  <section>
    <title id="scope">Scope.</title>

    <section>
      <title id="identification">Identification.</title>

      <para>This document describes the design of <ulink
      url="http://geotools.org">Geotools2</ulink>.</para>
    </section>

    <section>
      <title id="systemoverview">System overview.</title>

      <para>Geotools 2 is an open source, java GIS toolkit for developing
      standards compliant solutions. It&#39;s modular architecture allows
      extra functionality to be easily incorporated. Geotools 2 aims to
      support Open GIS and other relevant standards as they are developed.</para>

      <para>GeoTools 2 code is built using the latest Java tools and
      environments (Java 1.4.1 at time of writing) and will continue to
      leverage the capabilities of future Java environments and official
      extensions as and when the technologies are released and have been
      through the first maintenance cycle (i.e. version 1.x.1).</para>

      <para>The GeoTools2 project is divided into separate modules, each of
      which implements a specific requirement. Only a subset of these modules
      is usually required to build an application based on Geotools2.</para>
    </section>

    <section>
      <title id="documentoverview">Document overview.</title>

      <para>This Software Design Document is based on the <ulink
      url="http://www.pogner.demon.co.uk/mil_498/sdd-did.htm">MIL-STD 498
      Software Design Description Data Item Description (SDD DID)</ulink>.
      MIL-STD 498 specifies a software development framework and the SDD DID
      specifies the heading structure and content for each section.</para>

      <para>This document aims to help developers and users understand
      Geotools2. It aims to show design patterns between modules, relevance of
      key classes within each module and reasons for design decisions.
      Detailed information about classes can be found in the Geotools2
      <emphasis>javadocs</emphasis>.</para>

      <para>Class diagrams in this document were created using <ulink
      url="http://www.gentleware.com/products/index.php3">Poseidon</ulink>.
      You can download <emphasis>Poseidon</emphasis>, reverse engineer the
      code and interactively view diagrams, javadocs and code.</para>
    </section>

    <section>
      <title id="licence">Licence.</title>

      <para>Copyright (c) 2002 Cameron Shorter. Permission is granted to copy,
      distribute and/or modify this document under the terms of the <ulink
      url="http://www.fsf.org/copyleft/fdl.html">GNU Free Documentation
      License</ulink>, Version 1.1 or any later version published by the Free
      Software Foundation; with the Invariant Sections being with no Invariant
      Sections, with the Front-Cover Texts being no Front-Cover Texts, and
      with the Back-Cover Texts being no Back-Cover Texts.</para>
    </section>
  </section>

  <section>
    <title id="referencedocuments">Reference documents.</title>

    <itemizedlist>
      <listitem>
        <para><citetitle>Design Patterns, Elements of Reusable Object-Oriented
        Software</citetitle>, Erich Gamma, Richard Helm, Ralph Johnson, John
        Vlissides. An excellent book describing reusable design patterns, some
        of which are referenced in this document.</para>
      </listitem>

      <listitem>
        <para><citetitle>Geotools2 Javadocs</citetitle>.</para>
      </listitem>

      <listitem>
        <para><ulink url="http://www.pogner.demon.co.uk/mil_498/sdd-did.htm">MIL-STD
        498 Software Design Description Data Item Description (SDD DID)</ulink>.
        This template was loosely used to structure this document.</para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title id="designdecisions">Geotools2 wide design decisions.</title>

    <section>
      <title>Geotools2 in Context</title>

      <figure>
        <title>Geotools2 in Context</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/design/context.png" />
          </imageobject>
        </mediaobject>

        <blockquote>
          <para>Geotools2 and the systems it interacts with.</para>
        </blockquote>
      </figure>

      <variablelist>
        <varlistentry>
          <term>Applications</term>

          <listitem>
            <para>Applications are geographic applications which use geotools2
            primitives. They are generally end products like Map Viewers, Web
            Map Servers and so on.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>GeoInterfaces</term>

          <listitem>
            <para>GeoInterfaces contains interfaces for all the key geographic
            primitives like a Feature, Extent, Data Source and so on.
            Geotools2 key purpose is to provide implementations for some of
            the these interfaces.</para>

            <para>Not all interfaces are implemented, some functionality is
            imported from external vendors. For instance, Geotools2 uses the
            Java Topology Suite (JTS) to store core geographic primitives.</para>

            <para>At the time of writing (October 10, 2002), the GeoInterfaces
            project was still at the proposal stage.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>Data</term>

          <listitem>
            <para>Data is the geographic data that geotools2 manipulates.
            These may be in a database, ESRI shapefile or some other format.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>Geographic Objects</term>

          <listitem>
            <para>Geographic Objects are the core geographic primitives
            provided by the Java Topology Suite (JTS).</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>

    <section>
      <title id="designdrivers">Design Drivers</title>

      <variablelist>
        <varlistentry>
          <term>Modular</term>

          <listitem>
            <para>Geotools2 uses a modular design. The benefits of this
            include:</para>

            <itemizedlist>
              <listitem>
                <para>The design is easier to understand.</para>
              </listitem>

              <listitem>
                <para>Extra functionality can be incorporated easilly because
                a developer only needs to understand the module they are
                working on.</para>
              </listitem>

              <listitem>
                <para>Existing modules can be reworked with minimal effect on
                the rest of Geotools2.</para>
              </listitem>

              <listitem>
                <para>Applications which use Geotools2 only need to include
                the subset of the modules required.</para>
              </listitem>
            </itemizedlist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>Toolkit</term>

          <listitem>
            <para>Geotools2 is a toolkit to be used by multiple applications,
            it is not designed to be an application itself. Geotools2 aims to
            implement all the common elements used by GIS applications.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>OGC Compliant</term>

          <listitem>
            <para>Geotools2 aims to implement the Open GIS Consortium (OGC)
            specifications as they become available.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>Implements GeoInterfaces</term>

          <listitem>
            <para>The <emphasis>GeoInterfaces</emphasis> project defines
            geographic components and Geotools2 provides implimentations of
            these interfaces.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>Open Source</term>

          <listitem>
            <para>Geotools2 is released under the LGPL Open Source licence.
            External packages Geotools2 depends upon must use a similar
            licence to ensure users can use Geotools2 under the LGPL licence.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
  </section>

  <section>
    <title id="architecturaldesign">Geotools2 architectural design.</title>

    <section>
      <title id="geotoolscomponents">Geotools2 components.</title>

      <section>
        <title id="modulesoverview">Modules overview</title>

        <para>to do:</para>

        <itemizedlist>
          <listitem>
            <para>explain the reasoning behind having a core/defaultcore
            implementation.</para>
          </listitem>

          <listitem>
            <para>Expand the module sections to explain each module&#39;s
            design.</para>
          </listitem>
        </itemizedlist>

        <para>The GeoTools2 (GT2) project is divided into a number of separate
        module, each of which implements a specific requirement. Only a subset
        of these modules is usually required to build an application based on
        GT2.</para>

        <figure id="figureoverview">
          <title>Geotools2 modules</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/design/overview.png" />
            </imageobject>
          </mediaobject>

          <blockquote>
            <para>The hierarchy of the Geotools2 internal modules.</para>
          </blockquote>
        </figure>

        <itemizedlist>
          <title>Geotools modules</title>

          <listitem>
            <para>core: At the hart of GT2 is the core module, this module
            contains no implementation code, just Java interfaces for all the
            key modules.</para>
          </listitem>

          <listitem>
            <para>defaultcore: The next important module is the defaultcore
            which provides an implementation of the key interfaces found in
            the core module with the exception of datasource and rendering.
            The defaultcore module contains code which uses the latest version
            of Java (1.4) though it is envisioned that alternative
            implementations of core could be made in future, perhaps to target
            J2ME.</para>

            <para>The datasource and rendering interfaces are not implemented
            by the defaultcore module as there will need to be multiple
            implementations available so implementation is left to other
            modules. Note that although the defaultcore module includes a full
            set of objects for representing the SLD and Filter specification
            there is no code in these modules for reading or writing such
            documents, instead an entirely programmatic approach is assumed
            with IO for such specifications being left to other modules.</para>
          </listitem>

          <listitem>
            <para>Rendering: The rendering modules are responsible for
            rendering geographic data.</para>
          </listitem>

          <listitem>
            <para>Transforms: These modules manipulate geographic data.</para>
          </listitem>

          <listitem>
            <para>DataSources: These modules read native geographic data
            formats and convert it to a format usable by geotools2.</para>
          </listitem>
        </itemizedlist>

        <para>JavaDoc API for modules can be found at:
        modules.geotools.org/core.</para>

        <para><link linkend="geotoolsdetaileddesign">Detailed Design</link>
        contains more information about the modules.</para>
      </section>
    </section>

    <section>
      <title id="conceptofexecution">Concept of execution.</title>

      <itemizedlist>
        <listitem>
          <para>Sequence Diagrams/Collaberation Diagrams showing the
          relationships between modules.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section>
      <title id="interfacedesign">Interface design.</title>

      <para></para>

      <section>
        <title id="interfaceidentificationanddiagrams">Interface
        identification and diagrams.</title>

        <para></para>
      </section>

      <section>
        <title>Module XXX</title>

        <para></para>
      </section>

      <section>
        <title>Module YYY</title>

        <para></para>
      </section>
    </section>
  </section>

  <section>
    <title id="geotoolsdetaileddesign">Geotools2 detailed design.</title>

    <section>
      <title>todo</title>

      <para>The 5.x sections need to be filled out with more detail.</para>
    </section>

    <section>
      <title id="modulecore">core</title>

      <para>At the hart of GT2 is the core module, this module contains no
      implementation code, just Java interfaces for all the key modules. It is
      anticipated that the core module will be extracted out of Geotools and
      be put into it&#39;s own GeoInterfaces open source project.</para>
    </section>

    <section>
      <title id="moduledefaultcore">defaultcore</title>

      <para>Defaultcore provides an implementation of the key interfaces found
      in the core module with the exception of datasource and rendering. The
      defaultcore module contains code which uses the latest version of Java
      (1.4) though it is envisioned that alternative implementations of core
      could be made in future, perhaps to target J2ME.</para>

      <para>The datasource and rendering interfaces are not implemented by the
      defaultcore module as there will need to be multiple implementations
      available so implementation is left to other modules. Note that although
      the defaultcore module includes a full set of objects for representing
      the SLD and Filter specification there is no code in these modules for
      reading or writing such documents, instead an entirely programmatic
      approach is assumed with IO for such specifications being left to other
      modules.</para>
    </section>

    <section>
      <title id="gui">gui</title>

      <para>gui - a suite of visual components for navigating and displaying
      maps produced by a renderer.</para>

      <section>
        <title>Model-View-Controller</title>

        <figure>
          <title>Model View Controller</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/design/ModelViewController.png" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>The Geotools2 dispay objects use a <emphasis>Model-View-Controller</emphasis>
        design pattern. Context is the model, GeoWidgets like MapPane are the
        viewers, and Tools like the ZoomTool are the controllers.</para>

        <para>This design ensures the same data can be displayed in many ways
        and the rendering technology is independant of the data.</para>

        <para><emphasis>GeoWidgets</emphasis> register with data objects they
        are interested in then redraw themselves when they recieve
        <emphasis>dataChangedEvents</emphasis>. For example, the
        <emphasis>Legend</emphasis> widget registers interest with the
        <emphasis>LayerList</emphasis> object. When a new Layer is added,
        removed or selected, the <emphasis>Legend</emphasis> recieves a
        <emphasis>LayerListChangedEvent</emphasis> and redraws itself.</para>
      </section>

      <section>
        <title id="geowidgets">GeoWidgets</title>

        <figure>
          <title>Widget Factory</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/design/WidgetFactory.png" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>Classes that display Geotools data are called
        <emphasis>GeoWidgets</emphasis>. Examples include:</para>

        <itemizedlist>
          <listitem>
            <para>MapPane, this is the main widget which displays an image of
            geographic map.</para>
          </listitem>

          <listitem>
            <para>LocatorMap, similar to the MapPane, but has a static basemap
            and shows a box showing the <emphasis>area of interest</emphasis>.</para>
          </listitem>

          <listitem>
            <para>Legend, shows a list of layers.</para>
          </listitem>

          <listitem>
            <para>etc.</para>
          </listitem>
        </itemizedlist>

        <para>To create GeoWidgets, applications should use
        <emphasis>WidgetFactory</emphasis>. This uses an Abstract Factory
        design pattern which ensures that calling applications are not
        dependant the rendering technology chosen.</para>
      </section>

      <section>
        <title id="rendering">Rendering</title>

        <para>Rendering objects in Geotools2 are independant of data objects
        and the calling applications. This design allows multiple
        <emphasis>rendering</emphasis> implimentations. Consequently Geotools
        can have rendering for Swing, AWT, and Palm Pilot technologies.</para>

        <figure>
          <title>Rendering</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/design/Rendering.png" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>The swing rendering model uses cached RenderedFeatures to speed
        up rendering. <emphasis>RenderedFeature</emphasis> speeds up rendering
        by ensuring styling and coordinate transforms are only applied to
        features one.</para>
      </section>

      <section>
        <title id="tools">Tools</title>

        <figure>
          <title>Tools</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/design/Tools.png" />
            </imageobject>
          </mediaobject>
        </figure>

        <para><emphasis>Tools</emphasis> process key and mouse action events
        for <emphasis>GeoWidgets</emphasis>. Different Tools can be applied to
        <emphasis>GeoWidgets</emphasis> to trigger different behaviour. For
        example, when a <emphasis>ZoomTool</emphasis> is applied to
        <emphasis>MapPane</emphasis>, mouse click and drag will create a box
        and then zoom the extent into that box. When <emphasis>PanTool</emphasis>
        is used, the entire map drags around the screen during a click and
        drag.</para>
      </section>
    </section>

    <section>
      <title id="map">map</title>

      <figure>
        <title>Map Context</title>

        <mediaobject>
          <imageobject>
            <imagedata fileref="images/design/MapContext.png" />
          </imageobject>
        </mediaobject>
      </figure>

      <para><emphasis>MapContext</emphasis> stores geographic information in a
      series of <emphasis>MapState</emphasis> classes: Layers, Area of
      Interest, Coordinate System etc. <emphasis>MapState</emphasis> classes
      send events to interested objects when it&#39;s data changes.</para>

      <para>Multiple <emphasis>MapContext</emphasis> objects can be created
      using similar components in order to create widgets which share common
      components. For example. A display may contain two <emphasis>MapPanes</emphasis>
      which show the same area but use different basemaps. This would be
      achieved by building two <emphasis>MapContexts</emphasis> which use the
      same extent <emphasis>Envelope</emphasis> but use different
      <emphasis>LayerLists</emphasis>.</para>

      <para><emphasis>MapContext</emphasis> is based on the OGC Web Map
      Context Specification which means <emphasis>MapContext</emphasis> can be
      stored as XML and recreated by other applications which implement the
      OGC Web Map Context Specification.</para>
    </section>

    <section>
      <title id="modulejava2drenderer">java2drenderer</title>

      <para>java2drenderer - an implementation of the rendering interface
      which uses the Java2D API.</para>
    </section>

    <section>
      <title id="modulesldstyling">sldstyling</title>

      <para>An IO module which can read and write SLD XML documents by
      converting to and from the style objects implemented in defaultcore.</para>
    </section>

    <section>
      <title id="modulesvgsupport">svgsupport</title>

      <para>A module which extends the java2drenderer so that SVG files can be
      created.</para>
    </section>

    <section>
      <title id="modulefilter">filter</title>

      <para>An IO module which can read and write Filter Encoding XML
      documents by converting to and from the filter objects implemented in
      defaultcore.</para>
    </section>

    <section>
      <title id="modulepostgis">postgis</title>

      <para>A datasource implementation for pulling spatial and attribute data
      from a PostGIS database. (taking advantage of the spatial capabilities
      of PostGIS).</para>
    </section>

    <section>
      <title id="modulemysql">mysql</title>

      <para>A datasource implementation for pulling spatial and attribute data
      from a MySQL database. (working around the lack of spatial capability in
      MySQL).</para>
    </section>

    <section>
      <title id="modulegmldatasource">gmldatasource</title>

      <para>A datasource implementation which can parse GML 2 encoded
      information.</para>
    </section>

    <section>
      <title id="modulemapinfo">mapinfo</title>

      <para>A datasource implementation which can read MIF/MID files.</para>
    </section>

    <section>
      <title id="moduleshapefile">shapefile</title>

      <para>A datasource implementation which can read Shapefiles.</para>
    </section>

    <section>
      <title id="modulects-coordtrans">cts-coordtrans</title>

      <para>cts-coordtrans - an implementation of the Coordinate
      Transformation specifications.</para>
    </section>

    <section>
      <title id="modulegcs-coverage">gcs-coverage</title>

      <para>gcs-coverage - an implementation of the Grid Coverages
      specification.</para>
    </section>

    <section>
      <title id="modulealgorithms">algorithms</title>

      <para>A suite of algorithms for analysing and manipulating geographic
      objects.</para>
    </section>

    <section>
      <title id="modulewmsserver">wmsserver</title>

      <para>An implementation of the OGC WMS spec, including support for SLD.</para>

      <para>A WFS has been implemented as a separate project using the GT2
      code base and it envisioned that the wmsserver module will soon be
      extracted and become part of a separate project which still using the
      GT2 as a base.</para>
    </section>
  </section>

  <section>
    <title id="requirementstraceability">Requirements traceability.</title>

    <para>Since this is an open source project, without a commercial contract
    to be satisfied, there are no requirements to trace to. Hence, this
    section is not addressed.</para>
  </section>

  <section>
    <title id="notes">Notes.</title>

    <para>This section deliberately left blank.</para>
  </section>
</article>
